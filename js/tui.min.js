const MAIN_CONTAINER = document.getElementById("main-container"),
      SECTION_CONTAINER = document.getElementById("section-container"),
      LEFT_SECTION = document.getElementById("left-section"),
      RIGHT_SECTION = document.getElementById("right-section"),
      HOME_SECTION = document.getElementById("home"),
      SKILLS_SECTION = document.getElementById("skills"),
      EXPERIENCE_SECTION = document.getElementById("experience"),
      PROJECTS_SECTION = document.getElementById("projects"),
      FOOTER_SECTION = document.getElementById("footer"),
      MAIN_CONTENT_SECTION = document.getElementById("main-content")?.getElementsByClassName("container-content")[0],
      COLORS = ["text-blue", "text-orange", "text-pink"];

let left_sections = [
    {name:"home", section:HOME_SECTION, items:[]},
    {name:"experience", section:EXPERIENCE_SECTION, items:[...EXPERIENCE_SECTION.firstElementChild.children[2].children]},
    {name:"projects", section:PROJECTS_SECTION, items:[...PROJECTS_SECTION.firstElementChild.children[2].children]},
    {name:"skills", section:SKILLS_SECTION, items:[...SKILLS_SECTION.firstElementChild.children[2].children]}
];

let currentPosition = {sectionIndex:0, sectionItemIndex:0};
let previousPosition = {sectionIndex:0, sectionItemIndex:0};

function clamp(a, b, c){ return Math.min(Math.max(a, b), c); }
function isMobile(){ return window.innerWidth <= 768; }
function getRandomTextColorClass(){ return COLORS[Math.floor(Math.random() * COLORS.length)]; }
function colorizeString(a){ return a.replaceAll("{{",()=>`<span class="${getRandomTextColorClass()}">`).replaceAll("}}","</span>"); }

async function displayContent() {
    clearMainContent();
    const sectionName = left_sections[currentPosition.sectionIndex].name;
    const resp = await fetch(`data/${sectionName}.json`);
    const { data } = await resp.json();

    const outer = document.createElement("div");
    outer.classList.add("outer-paragraph-container");
    const inner = document.createElement("div");
    inner.classList.add("inner-paragraph-container");

    if(sectionName !== "home"){
        inner.classList.add("mt-4");
        const item = data[currentPosition.sectionItemIndex];
        const titleDiv = document.createElement("div");
        const h1 = document.createElement("h1");
        h1.innerHTML = item?.title ? `<span class="${getRandomTextColorClass()}">${item.title}</span>` : null;
        titleDiv.appendChild(h1);
        inner.prepend(titleDiv);
        outer.appendChild(inner);
        MAIN_CONTENT_SECTION.appendChild(outer);
        colorizeCode();
    } else {
        const logoNum = Math.floor(4 * Math.random()) + 1;
        const logoContainer = document.createElement("div");
        logoContainer.id = "logo-container";
        const logoImg = document.createElement("img");
        logoImg.src = `images/logo${logoNum}.svg`;
        logoImg.id = "logo";
        logoImg.alt = "Wallenart";
        logoContainer.appendChild(logoImg);
        MAIN_CONTENT_SECTION.appendChild(logoContainer);

        data.forEach(sec => {
            const secDiv = document.createElement("div");
            sec.content.forEach(p => {
                const pEl = document.createElement("p");
                pEl.innerHTML = colorizeString(p);
                secDiv.appendChild(pEl);
            });
            inner.appendChild(secDiv);
        });

        outer.appendChild(inner);
        MAIN_CONTENT_SECTION.appendChild(outer);
    }
}

function clearMainContent() {
    if(MAIN_CONTENT_SECTION) {
        MAIN_CONTENT_SECTION.innerHTML = "";
        MAIN_CONTENT_SECTION.scrollTo({top:0});
    }
}

// (Keep all your goToSection/goToNextSection/etc. functions as-is)

async function init(){
    initKeyboardListeners();
    initMouseListeners();
    initTouchListeners();
    await render(true, true); // keep async flow intact
}
